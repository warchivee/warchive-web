import{r as g,j as r,c as p,B as v,T as j,R as k,a as N,I as S,b as x,d as K}from"./index-39hTYAsx.js";import{I}from"./index-_ctq95tO.js";import{s as L,a as w,b as C,t as B,W as E}from"./wata.atom-OmgfIt4O.js";const W=(e,s)=>{const[o,l]=g.useState(1),c=Math.ceil(e.length/s),a=n=>{l(Math.max(1,Math.min(n,c)))};return[e.slice((o-1)*s,o*s),o,c,a]},P=W,T=(e,s)=>{const l=Math.max(1,Math.min(e-2,s-5+1)),c=Math.min(l+5-1,s);return Array.from({length:c-l+1},(i,n)=>l+n)};function M({currentPage:e,maxPage:s,onChange:o=()=>{}}){var l;return r.jsxs("div",{className:"pagination",children:[r.jsx("div",{className:p("control",{hidden:e<=3}),children:r.jsx(v,{icon:"angles-left",onClick:()=>{o(1)}})}),r.jsx("div",{className:"pages",children:(l=T(e,s))==null?void 0:l.map(c=>r.jsx("div",{className:p({active:c===e}),onClick:()=>{o(c)},"aria-hidden":"true",children:r.jsx(j,{size:"big",children:c})},`page-${c}`))}),r.jsx("div",{className:p("control",{hidden:e+2>=s}),children:r.jsx(v,{icon:"angles-right",onClick:()=>{o(s)}})})]})}const b=(e,s)=>{if(e.length===0)return!0;const o=new Set(e.map(a=>a.value)),l=new Set(s.map(a=>a.value));let c=!1;return o.forEach(a=>(l.has(a)&&(c=!0),!1)),c},R=k({key:"searchWataListSelector",get:({get:e})=>{const s=e(L),o=e(w),{searchInput:l,category:c,genres:a,platforms:i,keywords:n}=s;return o==null?void 0:o.filter(t=>(!l||t.title.includes(l)||t.creator.includes(l))&&(c.value==="category-전체"||t.category.value===c.value)&&(a.length===0||(a==null?void 0:a.some(m=>t.genre.value===m.value)))&&b(i,t.platforms)&&b(n,t.keywords))}}),A=R,z=(e,s)=>e.filter(o=>o.value!==s.value),O=(e,s)=>[...e,s],D=()=>{const[e,s]=N(C);return{searchKeywords:e,updateSearchKeywords:(a,i)=>{const t=e[a].some(m=>m.value===i.value)?z:O;s({...e,[a]:t(e[a],i)})},resetSearchKeywords:a=>{s({searchInput:"",category:a||e.category,genres:[],platforms:[],keywords:[]})},hasSelectedKeywords:()=>e.genres.length!==0||e.platforms.length!==0||e.keywords.length!==0}},F=(e,s,o)=>{const l={genres:[],platforms:[],keywords:[]},{genre_list:c,platform_list:a,keyword_list:i}=o;return c==null||c.forEach(n=>{e!=null&&e.some(t=>s===t.category.label&&t.genre.label===n)&&l.genres.push({value:`genre-${n}`,label:n})}),a==null||a.forEach(n=>{e!=null&&e.some(t=>s===t.category.label&&t.platforms.some(m=>m.label===n))&&l.platforms.push({value:`platform-${n}`,label:n})}),i==null||i.forEach(n=>{e!=null&&e.some(t=>s===t.category.label&&t.keywords.some(m=>m.label===n))&&l.keywords.push({value:`keyword-${n}`,label:n})}),l},H=k({key:"keywordListSelector",get:async({get:e})=>{const s=e(w),{allKeyword_list:o}=B,{category_list:l,genre_list:c,platform_list:a,keyword_list:i}=o,n=l==null?void 0:l.map(t=>({value:`category-${t}`,label:t,...F(s,t,o)}));return n.unshift({value:"category-전체",label:"전체",genres:c.map(t=>({label:t,value:`genre-${t}`})),platforms:a.map(t=>({label:t,value:`platform-${t}`})),keywords:i.map(t=>({label:t,value:`keyword-${t}`}))}),n}}),q=H;function $({value:e="keyword-1",label:s="키워드",type:o="default",size:l="normal",checked:c=!1,onChange:a=()=>{}}){return r.jsxs("div",{className:"bubble",children:[r.jsx("input",{type:"checkbox",name:e,id:e,checked:c,onChange:a}),r.jsxs("label",{htmlFor:e,className:p({[`${o}`]:o}),children:[r.jsx(j,{size:l,children:s}),o==="remove"&&r.jsx(S,{type:"xmark",size:l,color:"french-lilac"})]})]})}function G({title:e,bubbles:s=[],bubbleType:o,selectedBubbles:l=[],handleChange:c=()=>{}}){return r.jsxs("div",{className:"bubbles",children:[r.jsx(x,{type:"h4",color:"french-lilac",children:e}),r.jsx("div",{className:"grid",children:s==null?void 0:s.map(a=>r.jsx($,{value:a.value,label:a.label,checked:l.some(i=>i.value===a.value),onChange:()=>c(o,a)},`bubble-${a.value}`))})]})}function J(){const e=K(q),[s,o]=g.useState(0),[l,c]=g.useState(!1),{searchKeywords:a,updateSearchKeywords:i,resetSearchKeywords:n,hasSelectedKeywords:t}=D(),m=d=>{const h=s===d;h||n({label:e[d].label,value:e[d].value}),o(h?s:d),c(h?!l:!0)},y=(d,h,u,_)=>r.jsx(G,{title:h,bubbleType:u,bubbles:_,selectedBubbles:a[u],handleChange:i},`${d}-${h}`),f=(d,h)=>d==null?void 0:d.map(u=>r.jsx($,{value:`selected-${u.value}`,label:u.label,type:"remove",onChange:()=>{i(h,u)}},u.value));return r.jsxs("div",{className:"keyword-search-board",children:[r.jsxs("div",{className:"tabs",children:[r.jsxs("div",{className:"control",onClick:()=>{c(!l)},"aria-hidden":"true",children:[r.jsx(x,{type:"h5",color:"white",children:"키워드로 검색"}),r.jsx(S,{size:"small",color:"white",type:l?"up":"down"})]}),e==null?void 0:e.map((d,h)=>r.jsx("div",{className:p("tab",{select:s===h}),onClick:()=>m(h),"aria-hidden":"true",children:r.jsx(x,{type:"h4",color:"white",children:d.label})},d.value))]}),r.jsx("div",{className:p("panel-background",{hidden:!l}),children:r.jsxs("div",{className:"panel",children:[y(e[s].value,"장르","genres",e[s].genres),r.jsx("div",{className:"driven"}),y(e[s].value,"플랫폼","platforms",e[s].platforms),r.jsx("div",{className:"driven"}),y(e[s].value,"키워드","keywords",e[s].keywords)]})}),l||t()?r.jsxs("div",{className:"select-keywords",children:[r.jsxs("div",{className:"keywords",children:[f(a.genres,"genres"),f(a.platforms,"platforms"),f(a.keywords,"keywords")]}),t()&&r.jsx(v,{background:"lavender",labelColor:"french-lilac",border:"round",size:"small",onClick:()=>{n()},children:"검색 초기화"})]}):null]})}function X(){const e=K(A),[s,o]=N(C),[l,c,a,i]=P(e,20);return g.useEffect(()=>{i(1)},[s]),r.jsxs("div",{className:"page home",children:[r.jsx(J,{}),r.jsxs("div",{className:"content",children:[r.jsx("div",{className:"searchbar",children:r.jsx(I,{value:s.searchInput,type:"search",placeholder:"제목/작가/감독명으로 검색",onChange:n=>{o({...s,searchInput:n})}})}),r.jsxs(j,{size:"big",children:["검색 결과는 총 ",e.length," 개 입니다."]}),r.jsx(E,{watas:l}),r.jsx(M,{currentPage:c,onChange:i,maxPage:a})]})]})}export{X as default};
